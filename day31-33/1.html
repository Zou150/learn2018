
<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>IFE ECMAScript</title>
</head>

<body>
<select id="region-select">
    <option value="0">请选择</option>
    <option value="1">华东</option>
    <option value="2">华南</option>
    <option value="3">华北</option>
</select>

<select id="product-select">
    <option value="0">请选择</option>
    <option value="1">手机</option>
    <option value="2">笔记本</option>
    <option value="3">智能音箱</option>
</select>

<div id="table-wrapper">
</div>

<script type="text/javascript" src="ife31data.js"></script>
<script>
    var region = document.getElementById("region-select");
    var table = document.getElementById("table-wrapper");
    var product = document.getElementById("product-select");
    region.onchange = function () {
        renderTable(getData());
    }
    product.onchange = function () {
        renderTable(getData());
    }
    // 根据select选项获取数据
    function getData() {
        var index = region.selectedIndex;
        var index2 = product.selectedIndex;
        var selectedRegion = region.options[index].value;
        var selectedProduct = product.options[index2].value;
        var res = new Array();
        if (selectedRegion == 1) {
            for (var i = 0; i < sourceData.length; i++) {
                if (sourceData[i].region == '华东') {
                    switch (selectedProduct) {
                        case "1":
                            if (sourceData[i].product == '手机') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "2":
                            if (sourceData[i].product == '笔记本') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "3":
                            if (sourceData[i].product == '智能音箱') {
                                res[i] = sourceData[i];
                            }
                            break;
                        default:
                            res[i] = sourceData[i];
                            break;
                    }
                }
            }
        } else if (selectedRegion == 2) {
            for (var i = 0; i < sourceData.length; i++) {
                if (sourceData[i].region == '华南') {
                    switch (selectedProduct) {
                        case "1":
                            if (sourceData[i].product == '手机') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "2":
                            if (sourceData[i].product == '笔记本') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "3":
                            if (sourceData[i].product == '智能音箱') {
                                res[i] = sourceData[i];
                            }
                            break;
                        default:
                            res[i] = sourceData[i];
                            break;
                    }
                }
            }
        } else if (selectedRegion == 3) {
            for (var i = 0; i < sourceData.length; i++) {
                if (sourceData[i].region == '华北') {
                    switch (selectedProduct) {
                        case "1":
                            if (sourceData[i].product == '手机') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "2":
                            if (sourceData[i].product == '笔记本') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "3":
                            if (sourceData[i].product == '智能音箱') {
                                res[i] = sourceData[i];
                            }
                            break;
                        default:
                            res[i] = sourceData[i];
                            break;
                    }
                }
            }
        } else {
            for (var i = 0; i < sourceData.length; i++) {
                switch (selectedProduct) {
                    case "1":
                        if (sourceData[i].product == '手机') {
                            res[i] = sourceData[i];
                        }
                        break;
                    case "2":
                        if (sourceData[i].product == '笔记本') {
                            res[i] = sourceData[i];
                        }
                        break;
                    case "3":
                        if (sourceData[i].product == '智能音箱') {
                            res[i] = sourceData[i];
                        }
                        break;
                    default:
                        break;
                }
            }
        }
        //去除res数组中的空值
        for (var i = 0; i < res.length; i++) {
            if (typeof res[i] == "undefined" || res[i] == null) {
                res.splice(i, 1);
                i--;
            }
        }
        console.log(res)
        return res;
    }
    function renderTable(data) {
        // 输出表头：商品、地区、1月、2月、…… 12月
        var t_column = 14;
        var string = "<table border=\"1\"><thead><tr><th>商品</th><th>地区</th>";
        for (var i = 0; i < t_column - 2; i++) {
            string = string.concat("<th>" + (i + 1) + "月" + "</th>");
        }
        string = string.concat("</thead>");
        string = string.concat("<tbody>");
        for (var i = 0; i < data.length; i++) {
            string = string.concat("<tr>");
            string = string.concat("<td>" + data[i].product + "</td>");
            string = string.concat("<td>" + data[i].region + "</td>");
            for (var j = 0; j < t_column - 2; j++) {
                string = string.concat("<td>" + data[i].sale[j] + "</td>");
            }
            string = string.concat("</tr>");
        }
        string = string.concat("</tbody>");
        // 把生成的HTML内容赋给table-wrapper
        table.innerHTML = string;
    }
</script>
    

<!-- <script>
    var region = document.querySelector("#region-select")
    var product = document.querySelector("#product-select")
    var twrapper = document.querySelector("#table-wrapper")

    function getData(){
        var reindex = region.selectedIndex
        var retxt = region.options[reindex].text
        var proindex = product.selectedIndex
        var protxt = product.options[proindex].text
        var selectedData = []
        for(i=0;i<sourceData.length;i++){
            if(sourceData[i].region == retxt && sourceData[i].product == protxt){
                selectedData.push(sourceData[i])
            }
        }
        console.log(selectedData);
        return selectedData
    }


    function th1(){
        var tr1 = document.createElement("tr")
        var item1 = document.createTextNode("商品")
        var item2 = document.createTextNode("地区")
        var item3 = document.createTextNode("1月")
        var item4 = document.createTextNode("2月")
        var item5 = document.createTextNode("3月")
        var item6 = document.createTextNode("4月")
        var item7 = document.createTextNode("5月")
        var item8 = document.createTextNode("6月")
        var item9 = document.createTextNode("7月")
        var item10 = document.createTextNode("8月")
        var item11 = document.createTextNode("9月")
        var item12 = document.createTextNode("10月")
        var item13 = document.createTextNode("11月")
        var item14 = document.createTextNode("12月")
        var item = [item1,item2,item3,item4,item5,item6,item7,item8,item9,item10,item11,item12,item13,item14]
        for(i=0;i<14;i++){
            var th = document.createElement("th")
            th.appendChild(item[i])
            tr1.appendChild(th)
        }
        return tr1
    }

    function createTable(){
        var tab = document.createElement("table")
        twrapper.appendChild(tab)
        var table = document.querySelector("table")
        var thtemp = th1()
        table.appendChild(thtemp)
    }


    function clearTableData(){
        var table = document.querySelector("table")
        for(var i = table.children.length - 1; i > 0; i--) { 
            table.removeChild(table.children[i]); 
        }
    }

    function td(){
        var tempdata = getData()
        for(i=0;i<tempdata.length;i++){
            var tr = document.createElement("tr")
            var th = document.querySelector("table").firstElementChild.childNodes
            for(j=0;j<th.length;j++){
                var td = document.createElement("td")
                tr.appendChild(td)
            }
            var table = document.querySelector("table")
            table.appendChild(tr)
        }
        var trtemp = document.querySelectorAll("tr")
        for(k=0;k<tempdata.length;k++){
            var temppro = document.createTextNode(tempdata[k].product)
            var tempreg = document.createTextNode(tempdata[k].region)
            var tdtemp = trtemp[k+1].querySelectorAll("td")
            var td0 = tdtemp[0]
            var td1 = tdtemp[1]
            td0.appendChild(temppro)
            td1.appendChild(tempreg)
            for(l=2;l<14;l++){
                var s = l-2
                var tempsale = document.createTextNode(tempdata[k].sale[s])
                tdtemp[l].appendChild(tempsale)
            }
        }
    }


    createTable()
    region[0].selected = "selected"
    product[0].selected = "selected"
    td()


    var selects = document.querySelectorAll("select")
    for(i=0;i<selects.length;i++){
        selects[i].onchange = function(){
            clearTableData()
            td()
        }
    }
    </script> -->
</body>

</html>
