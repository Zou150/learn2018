
<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>IFE ECMAScript</title>
</head>

<body>
<select id="region-select">
    <option value="0">请选择</option>
    <option value="1">华东</option>
    <option value="2">华南</option>
    <option value="3">华北</option>
</select>

<select id="product-select">
    <option value="0">请选择</option>
    <option value="1">手机</option>
    <option value="2">笔记本</option>
    <option value="3">智能音箱</option>
</select>

<div id="table-wrapper">
</div>

<script type="text/javascript" src="ife31data.js"></script>
<script>
    var region = document.getElementById("region-select");
    var table = document.getElementById("table-wrapper");
    var product = document.getElementById("product-select");
    region.onchange = function () {
        renderTable(getData());
    }
    product.onchange = function () {
        renderTable(getData());
    }
    // 根据select选项获取数据
    function getData() {
        var index = region.selectedIndex;
        var index2 = product.selectedIndex;
        var selectedRegion = region.options[index].value;
        var selectedProduct = product.options[index2].value;
        var res = new Array();
        if (selectedRegion == 1) {
            for (var i = 0; i < sourceData.length; i++) {
                if (sourceData[i].region == '华东') {
                    switch (selectedProduct) {
                        case "1":
                            if (sourceData[i].product == '手机') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "2":
                            if (sourceData[i].product == '笔记本') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "3":
                            if (sourceData[i].product == '智能音箱') {
                                res[i] = sourceData[i];
                            }
                            break;
                        default:
                            res[i] = sourceData[i];
                            break;
                    }
                }
            }
        } else if (selectedRegion == 2) {
            for (var i = 0; i < sourceData.length; i++) {
                if (sourceData[i].region == '华南') {
                    switch (selectedProduct) {
                        case "1":
                            if (sourceData[i].product == '手机') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "2":
                            if (sourceData[i].product == '笔记本') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "3":
                            if (sourceData[i].product == '智能音箱') {
                                res[i] = sourceData[i];
                            }
                            break;
                        default:
                            res[i] = sourceData[i];
                            break;
                    }
                }
            }
        } else if (selectedRegion == 3) {
            for (var i = 0; i < sourceData.length; i++) {
                if (sourceData[i].region == '华北') {
                    switch (selectedProduct) {
                        case "1":
                            if (sourceData[i].product == '手机') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "2":
                            if (sourceData[i].product == '笔记本') {
                                res[i] = sourceData[i];
                            }
                            break;
                        case "3":
                            if (sourceData[i].product == '智能音箱') {
                                res[i] = sourceData[i];
                            }
                            break;
                        default:
                            res[i] = sourceData[i];
                            break;
                    }
                }
            }
        } else {
            for (var i = 0; i < sourceData.length; i++) {
                switch (selectedProduct) {
                    case "1":
                        if (sourceData[i].product == '手机') {
                            res[i] = sourceData[i];
                        }
                        break;
                    case "2":
                        if (sourceData[i].product == '笔记本') {
                            res[i] = sourceData[i];
                        }
                        break;
                    case "3":
                        if (sourceData[i].product == '智能音箱') {
                            res[i] = sourceData[i];
                        }
                        break;
                    default:
                        break;
                }
            }
        }
        //去除res数组中的空值
        for (var i = 0; i < res.length; i++) {
            if (typeof res[i] == "undefined" || res[i] == null) {
                res.splice(i, 1);
                i--;
            }
        }
        console.log(res)
        return res;
    }
    function renderTable(data) {
        // 输出表头：商品、地区、1月、2月、…… 12月
        var t_column = 14;
        var string = "<table border=\"1\"><thead><tr><th>商品</th><th>地区</th>";
        for (var i = 0; i < t_column - 2; i++) {
            string = string.concat("<th>" + (i + 1) + "月" + "</th>");
        }
        string = string.concat("</thead>");
        string = string.concat("<tbody>");
        for (var i = 0; i < data.length; i++) {
            string = string.concat("<tr>");
            string = string.concat("<td>" + data[i].product + "</td>");
            string = string.concat("<td>" + data[i].region + "</td>");
            for (var j = 0; j < t_column - 2; j++) {
                string = string.concat("<td>" + data[i].sale[j] + "</td>");
            }
            string = string.concat("</tr>");
        }
        string = string.concat("</tbody>");
        // 把生成的HTML内容赋给table-wrapper
        table.innerHTML = string;
    }
</script>

</body>

</html>
